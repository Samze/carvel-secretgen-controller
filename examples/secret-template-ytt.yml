apiVersion: v1
kind: Secret
metadata:
  name: secret1
type: Opaque
stringData:
  key1: val1
  key2: val2
---
apiVersion: v1
kind: Secret
metadata:
  name: secret2
type: Opaque
stringData:
  key3: val3
  key4: val4
---
apiVersion: secretgen.carvel.dev/v1alpha1
kind: SecretTemplate
metadata:
  name: combined-secret
spec:
  inputResources:
  - name: secret1 
    ref:
      apiVersion: v1
      kind: Secret
      name: secret1
  - name: secret2
    ref:
      apiVersion: v1
      kind: Secret
      name: secret2
  ytt: | 
    #@ load("@ytt:data", "data")
    #@ load("@ytt:base64", "base64")
    
    #! Store the input resource as data values with the key being 
    #! the specified reference name.
    #@ secret1 = data.values.secret1
    #@ secret2 = data.values.secret2
    metadata:
      labels: 
        foo: db-instance-secret
    type: foobar
    data:
      key1: #@ secret1.data.key1
      key3: #@ secret2.data.key3
    stringData:
      key4: foo
      key5: #@ base64.decode(secret1.data.key1) + "-" + base64.decode(secret1.data.key2)
